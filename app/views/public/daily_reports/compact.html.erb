<!-- ÂâçÂæå„Éä„ÉìÔºã„Çø„Ç§„Éà„É´ -->
<div class="d-flex justify-content-between align-items-center mt-4 mb-4">
  <% if @prev %>
    <%= link_to "‚Üê ÂâçÊó•", compact_daily_report_path(@prev), class: "btn btn-outline-secondary btn-sm" %>
  <% else %>
    <div style="width: 70px;"></div>
  <% end %>

  <h4 class="m-0 text-center flex-grow-1">
    <%= @daily_report.date.strftime("%-mÊúà%-dÊó•Ôºà%aÔºâ") %>
  </h4>

  <% if @next %>
    <%= link_to "ÁøåÊó• ‚Üí", compact_daily_report_path(@next), class: "btn btn-outline-secondary btn-sm" %>
  <% else %>
    <div style="width: 70px;"></div>
  <% end %>
</div>

<!-- Êó•Â†±Âü∫Êú¨ÊÉÖÂ†±„Ç´„Éº„Éâ -->
<div class="card mb-4 shadow-sm border-primary" style="border-left-width: .25rem;">
  <div class="card-header bg-white border-0 py-3">
    <div class="d-flex align-items-center">
      <div class="text-primary mr-3">
        <i class="far fa-calendar-alt fa-2x"></i>
      </div>
      <div>
        <h5 class="mb-0"><%= @daily_report.date.strftime("%YÂπ¥%-mÊúà%-dÊó•") %></h5>
        <small class="text-muted"><%= @daily_report.date.strftime("%A") %></small>
      </div>
      <div class="ml-auto">
        <span class="badge badge-secondary badge-pill py-2 px-3">
          <i class="fas fa-map-marker-alt mr-1"></i>
          <%= @daily_report.location.presence || "‚Äï" %>
        </span>
      </div>
    </div>
  </div>
  <div class="card-body py-4">
    <!-- Ê¥ªÂãïÂÜÖÂÆπ -->
    <p class="card-text lead" style="line-height: 1.6;">
      <%= simple_format(@daily_report.content) %>
    </p>

    <% if @daily_report.sentiment_score.present? %>
    <% score = @daily_report.sentiment_score.to_f %>
    <% 
      if    score >  0.3 then color = '#2ecc71'; emoji = 'üòä'
      elsif score < -0.3 then color = '#e74c3c'; emoji = 'üòü'
      else                   color = '#95a5a6'; emoji = 'üòê'
      end
    %>
  
    <!-- Êï∞Â≠óÔºãÁµµÊñáÂ≠óÔºãMIN/MAXË°®Á§∫ -->
    <div class="mb-3 d-flex align-items-center">
      <strong class="mr-2">ÊÑüÊÉÖ„Çπ„Ç≥„Ç¢</strong>
      <small class="text-muted"><%= score.round(2) %></small>
      <span class="ml-2"><%= emoji %></span>
  
      <!-- „Åì„Åì„Å†„ÅëËøΩÂä† -->
      <small class="text-muted ml-auto">
        MINÔºà‚àí1.0Ôºâ | &nbsp;&nbsp;MAXÔºà+1.0Ôºâ
      </small>
    </div>
  
    <!-- ‰ª•‰∏ã„É°„Éº„Çø„ÉºÊú¨‰Ωì„Å™„Å©„ÅØ„Åù„ÅÆ„Åæ„Åæ -->
    <div class="position-relative sentiment-meter" style="height:6px; background:#ececec; border-radius:3px;">
      <div class="sentiment-fill" style="width:<%= ((score + 1)/2.0*100).round %>%; background-color:<%= color %>;"></div>
      <div class="sentiment-marker" style="left:<%= ((score + 1)/2.0*100).round %>%; border-top:6px solid <%= color %>;"></div>
    </div>
  <% end %>

    <hr class="my-4">
    <!-- ÊäïÁ®øÊÉÖÂ†± -->
    <div class="d-flex flex-column flex-md-row justify-content-between text-muted small">
      <div class="d-flex align-items-center mb-2 mb-md-0">
        <i class="far fa-clock mr-1"></i>
        <span>ÊäïÁ®øÊôÇÈñì: <%= @daily_report.created_at.strftime("%Y-%m-%d %H:%M") %></span>
      </div>
      <div class="d-flex align-items-center">
        <i class="fas fa-user mr-1"></i>
        <span>
          ÊäïÁ®øËÄÖ:
          <%= link_to @daily_report.user.name,
                      user_path(@daily_report.user),
                      class: "text-reset font-weight-bold" %>
        </span>
      </div>
    </div>

    <!-- Â≠¶„Å≥„Å®ÊîπÂñÑÁÇπ -->
    <% if @daily_report.learning.present? %>
      <div class="mt-5 pt-4 border-top">
        <h5 class="font-weight-bold text-success mb-3">
          <i class="fas fa-lightbulb mr-1"></i> Â≠¶„Å≥„Å®ÊîπÂñÑÁÇπ
        </h5>
        <p class="card-text lead" style="line-height: 1.6;">
          <%= simple_format(@daily_report.learning) %>
        </p>
      </div>
    <% end %>
  </div>
</div>

<!-- „Çø„Çπ„ÇØ‰∏ÄË¶ß„ÉªËá™Â∑±Ë©ï‰æ°„ÉªÈñ¢ÈÄ£Ë®ò‰∫ã -->
<div class="row mb-5">
  <!-- „Çø„Çπ„ÇØ‰∏ÄË¶ß -->
  <div class="col-lg-6 mb-4">
    <div class="card h-100">
      <div class="card-header bg-light font-weight-bold">„Çø„Çπ„ÇØ‰∏ÄË¶ß</div>
      <ul class="list-group list-group-flush">
        <% if @daily_report.tasks.any? %>
          <% @daily_report.tasks.each do |task| %>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <span>
                <i class="<%= task.completed? ? 'fas fa-check-square text-success' : 'far fa-square text-muted' %> mr-2"></i>
                <%= task.title %>
              </span>
              <% if task.respond_to?(:due_date) && task.due_date %>
                <small class="text-muted"><%= task.due_date.strftime("%-m/%-d") %></small>
              <% end %>
            </li>
          <% end %>
        <% else %>
          <li class="list-group-item text-center text-muted">„Çø„Çπ„ÇØ„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</li>
        <% end %>
      </ul>
    </div>
  </div>

  <!-- Ëá™Â∑±Ë©ï‰æ° -->
  <div class="col-lg-6 mb-4">
    <div class="card h-100">
      <div class="card-header bg-light font-weight-bold">Ëá™Â∑±Ë©ï‰æ°</div>
      <div class="card-body d-flex flex-column justify-content-center align-items-center">
        <div class="mb-3">
          <% (1..5).each do |i| %>
            <i class="<%= i <= (@daily_report.self_evaluation || 0) ?
                        'fas fa-star text-warning' :
                        'far fa-star text-secondary' %> fa-2x mx-1"></i>
          <% end %>
        </div>
        <div>
          <span class="h5 mb-0"><%= @daily_report.self_evaluation || '‚Äï' %></span>
          <span class="text-muted">/ 5</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Èñ¢ÈÄ£ÊäïÁ®ø -->
  <% if @daily_report.respond_to?(:posts) && @daily_report.posts.any? %>
    <div class="col-12 mb-4">
      <div class="card">
        <div class="card-header font-weight-bold">Èñ¢ÈÄ£Ë®ò‰∫ã</div>
        <ul class="list-group list-group-flush">
          <% @daily_report.posts.each do |post| %>
            <li class="list-group-item">
              <%= link_to post.title, daily_report_post_path(@daily_report, post),
                          class: "text-dark" %>
            </li>
          <% end %>
        </ul>
      </div>
    </div>
  <% end %>
</div>

<!-- „Éú„Çø„É≥Áæ§ -->
<div class="d-flex justify-content-between mb-5">
  <%= link_to "„Éó„É≠„Éï„Ç£„Éº„É´„Å∏Êàª„Çã", user_path(@daily_report.user),
              class: "btn btn-outline-primary" %>
  <% if current_user == @daily_report.user %>
    <%= link_to "„É©„Ç§„Éï„É≠„Ç∞‰∏ÄË¶ß„Å∏", daily_reports_path,
                class: "btn btn-secondary" %>
  <% end %>
</div>